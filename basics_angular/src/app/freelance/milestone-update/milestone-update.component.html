<!--  -->

<app-loading-spinner *ngIf="spinnerOn"></app-loading-spinner>
<div class="container p-4" *ngIf="!spinnerOn">
  <div class="card text-white bg-black">
    <div class="card card-header text-white mx-auto">
      <h5>Update Milestone</h5>
    </div>
    <div class="card list-group-item border-0" *ngIf="milestoneModel != null">
      <div class="card-header">
        <h5 class="fs-5">Milestone {{ milestoneModel.id }}</h5>
      </div>
      <div class="card-body">
        <!-- row-of attribute -->
        <div class="d-grid">
          <span class="d-grid me-3">
            <h6>
              Goal Description:
              <span class="badge bg-danger ms-2">
                {{
                  (milestoneModel.amount ? milestoneModel.amount : 0)
                    | currency : "USD" : "symbol" : "1.0-0"
                }}-[{{ milestoneModel.amountPercentage | percent }} of Total
                Project Cost]</span
              >
            </h6>
            <p class="fs-6 ms-4">
              {{ milestoneModel.goalDescription }}
            </p>
          </span>
        </div>

        <div class="d-grid">
          <h6 class="flex-fill">Date Planeed To Start Working on Milestone:</h6>
          <p class="ms-4">
            {{ milestoneModel.dateStartWorking | date : "MM/dd/yyyy h:mm a z" }}
          </p>
        </div>

        <div class="d-grid">
          <h6 class="flex-fill">Date Payment of Milestone:</h6>
          <p class="ms-4">
            {{ milestoneModel.datePayment | date : "MM/dd/yyyy h:mm a z" }}
          </p>
        </div>

        <!-- <div *ngIf="showDescription"> -->
        <!-- Show application -->
        <div class="d-flex">
          <span class="me-3 flex-fill">
            <h6 class="flex-fill">Files:</h6>
            <p class="ms-4 flex-fill">
              <!-- loop downloadable files with span -->
              <span
                class="me-3 flex-fill"
                *ngFor="let file of milestoneModel.milestoneDeliverable"
                ><a [href]="file.path ? pathToDownload + file.path : '#'">
                  {{
                    (file.name ? file.name + "." : "") +
                      (file.extension ? file.extension : "")
                  }}
                </a></span
              >
            </p>
          </span>
        </div>

        <div class="d-grid">
          <h6 class="flex-fill">
            WalletId of Freelancer:(only visible for users owners)
          </h6>
          <p class="ms-4">
            {{ milestoneModel.walletFreelancer }}
          </p>
        </div>
        <div class="d-grid">
          <h6 class="flex-fill">
            WalletId of Customer:(only visible for users owners)
          </h6>
          <p class="ms-4">
            {{ milestoneModel.walletCustomer }}
          </p>
        </div>
        <!-- </div> -->
      </div>

      <!-- *************************************************************** -->
      <div class="card card-header bg-black text-danger mb-0">
        <h4>Updatable Items:</h4>
      </div>
      <div class="card card-body bg-black">
        <ng-container *ngIf="milestoneModel.freelancerId == currentUserId">
          <form [formGroup]="milestoneForm" (ngSubmit)="submitForm()">
            <div class="mb-3 mt-0">
              <label for="filesupload" class="form-label"
                >Add Your Milestone Deliverable
              </label>
              <app-input
                idInput="filesupload"
                typeInput="file"
                [isMultiple]="true"
                placeholderString="Ensert Relevent Project Files (templates, architecture , etc ...)"
                [control]="milestoneDeliverable"
                (change)="selectFile($event)"
              >
              </app-input>
            </div>
            <hr class="border-3" />

            <div class="card-footer d-flex text-white">
              <button
                [disabled]="
                  milestoneModel.freelancerId != currentUserId ||
                  milestoneModel.reclamationByGigCreator ||
                  milestoneModel.validatedByFreelancer ||
                  files.length == 0
                "
                class="btn btn-dark btn-outline-light btn-sm me-2 flex-fill"
                type="submit"
              >
                Commit Add Deliverable
              </button>
            </div>
          </form>
          <div class="card-footer d-flex text-white">
            <button
              [disabled]="
                milestoneModel.reclamationByGigCreator ||
                milestoneModel.freelancerId != currentUserId
              "
              class="btn btn-danger btn-outline-light btn-sm me-2 flex-fill"
              type="button"
              (click)="validateWorkDone($event)"
            >
              <b>Validate All Work Have been Submitted</b>
            </button>
          </div>
        </ng-container>
        <div class="card-footer d-flex text-white">
          <div class="alert alert-warning flex-fill">
            <small class="small-title flex-fill"
              >Only When U have finished All your tasks of the current milestone
              and all have been Uploaded Click On validate</small
            >
          </div>
        </div>
        <div class="mt-2" *ngIf="errorMsg !== null">
          <div class="alert alert-info">
            {{ errorMsg }}
          </div>
        </div>
      </div>
    </div>

    <!--  -->
  </div>
</div>
